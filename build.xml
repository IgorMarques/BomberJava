<!-- Copyright (C) 2013 Federal University of Pernambuco and 
     University of Central Florida
 
 * This file is part of AspectJML
 *
 * AJML is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2, or (at your option)
 * any later version.
 *
 * AJML is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with AJML; see the file COPYING.  If not, write to
 * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
 *
 * $Id: build.xml,v 3.0 2013/7/01 02:05:30 henriquerebelo Exp $ 
-->
<!-- THE FUN HAS JUST BEGUN!! AspectJML team -->
<project name="AspectJML tools release 5.0" default="run-all">

	<!-- THE ASPECTJML COMPILER (ajmlc) VERSION BEING USED  -->

	<property name="AspectJML"                 value="50" />


	<!-- SYSTEM DEPENDENT VARIABLES        -   CHANGE FOR YOUR NEEDS  -->
	<property name="aspectjml.release.jar"     value="lib-aspectjml5.0/aspectjml-release5.0.jar" />
	<property name="src.dir"                   value="src" />
	<!-- From within Eclipse, you can put the generated bytecode directly at the "bin" folder and run the application direclty from Eclipse-->
	<!-- This tip is useful if you have several main classes and to avoid run one by one by changing the "main.class" property -->
	<property name="dest.dir"                  value="bin" />
	<property name="crossref.dir"              value="crossref" />
	<property name="main.class"                value="graphics.window.GameWindow" />
	<property name="app.lib"                   value="lib" />
	<property name="aspectjml.lib"             value="lib-aspectjml5.0" />
	<!-- NOTE: 'aspectjml.lib' MUST INCLUDE ASPECTJ WEAVERS, AJC AND ABC -->

	<!-- CLASSPATH OF AspectJML TOOL FOR COMPILATION AND CHECKING TASKS -->
	<taskdef classpath="${aspectjml.release.jar}" resource="org/jmlspecs/ant/taskdefs/aspectjmlTaskdefs.properties" />

	<!-- CLASSPATH FOR COMPILATION AND TASKS -->
	<path id="classpath">
		<!-- IF YOU HAVE APPLICATION SPECIFIC LIB, UNCOMMENT THE FOLLOWING -->
		<!--<fileset dir="${app.lib}">
			<include name="*.jar" />
		</fileset>-->
		<fileset dir="${aspectjml.lib}">
			<include name="*.jar" />
		</fileset>
	</path>

	<!-- CREATE NEEDED DIRECTORIES -->
	<target name="prepare">
		<mkdir dir="${dest.dir}" />
	</target>

	<!-- CLEANUP -->
	<target name="clean">
		<delete dir="${dest.dir}" />
	</target>

	<!-- VERSION INFORMATION -->
	<target name="ajmlc-version-options" description="Task responsible for printing the ajmlc version">
		<java classname="org.jmlspecs.ajmlrac.Main" fork="true">
			<arg value="--version" />
			<classpath refid="classpath" />
		</java>
	</target>

	<!-- HELP OPTIONS -->
	<target name="ajmlc-help-options" description="Task responsible for displaying ajmlc compilation options">
		<java classname="org.jmlspecs.ajmlrac.Main" fork="true">
			<arg value="--help" />
			<classpath refid="classpath" />
		</java>
	</target>

	<!-- COMPILATIONS -->
	<!-- Note that these are the most common options used to run a AspectJML annotated Java program. 
		   - Also, these options include the advanced ones for AspectJML such as the modular crosscutting contracts specifications 
		     with "crosscuttingcontractspecifications" option. 
		   - All these advanced ajmlc options are not enabled by default.
		   - For more ajmlc options, please run the task above "ajmlc-help-options" and update the "ajmlc task" below to properly include them-->
	<!-- THE FUN HAS JUST BEGUN!! AspectJML team -->
	<target name="ajmlc" depends="clean,prepare" description="Ant task responsible for compiling Java files annotated with AspectJML using ajmlc compiler version ${AspectJML}">
		<ajmlc destdir="${dest.dir}" srcdir="${src.dir}" classpathref="classpath" print="false" source="1.5" ajweaver="ajc" defaultnonnull="true"
			noexecutionsiteinstrumenation="false" callsiteinstrumenation="false" clientawarechecking="false" multiplespeccasechecking="false" 
			crosscuttingcontractspecifications="false" advicechecking="false" showweaveinfo="false" verbose="true" fork="false">
		</ajmlc>
	</target>

	<!-- TYPE CHECKING -->
	<target name="ajml" description="Ant task responsible for type checking Java files annotated with AspectJML using ajml type checker version ${AspectJML}">
		<ajml destdir="${dest.dir}" srcdir="${src.dir}" classpathref="classpath" verbose="true">
		</ajml>
	</target>

	<!-- RUNNING APPLICATION -->
	<target name="ajmlrac" description="Ant task responsible for running the Java program (by means of a main class) which has embbeded AspectJML runtime checks (with aspects); ajmlrac version ${AspectJML}">
		<ajmlrac classname="${main.class}" classpathref="classpath" verbose="true">
			<classpath location="${dest.dir}" />
		</ajmlrac>
	</target>

	<!-- CROSS REFERENCE INFORMATION GENERATION FOR CROSSCUTTING CONTRACT SPECIFICATIONS-->
	<target name="cross-ref" depends="" description="Ant task responsible for generating the cross references of crosscutting contract specifications. This version is compatible with AspectJML using ajmlc compiler version ${AspectJML}">
		<mkdir dir="${crossref.dir}" />
		<crossref destdir="crossref" srcdir="${src.dir}" classpathref="classpath" />
	</target>

	<!-- CLEANUP CROSS REFERENCE INFORMATION ABOUT THE SPECIFIED  CROSSCUTTING CONTRACTS-->
	<target name="clean-cross-ref" description="Ant task responsible for cleaning all the cross references of crosscutting contract specifications. This version is compatible with AspectJML using ajmlc compiler version ${AspectJML}">
		<delete>
			<fileset dir="${crossref.dir}" includes="**/*.aj" />
		</delete>
	</target>

	<!-- SYSTEMS -->
	<target name="run-all" depends="clean,prepare,ajml,ajmlc,ajmlrac" />
</project>
